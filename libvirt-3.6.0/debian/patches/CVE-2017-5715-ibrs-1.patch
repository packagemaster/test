From 8b605530e80a13b44d8a05f5718a3edab18d3ff5 Mon Sep 17 00:00:00 2001
From: Paolo Bonzini <pbonzini@redhat.com>
Date: Tue, 12 Dec 2017 16:23:42 +0100
Subject: [PATCH] cpu: add CPU features for indirect branch prediction
 protection

Added in QEMU commits TBD and TBD.

Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Jiri Denemark <jdenemar@redhat.com>
Reviewed-by: Pavel Hrdina <phrdina@redhat.com>
---
 src/cpu/cpu_map.xml | 8 ++++++++
 1 file changed, 8 insertions(+)

Index: libvirt-3.6.0/src/cpu/cpu_map.xml
===================================================================
--- libvirt-3.6.0.orig/src/cpu/cpu_map.xml	2018-01-25 10:01:08.052427744 -0500
+++ libvirt-3.6.0/src/cpu/cpu_map.xml	2018-01-25 10:01:08.048427729 -0500
@@ -297,6 +297,9 @@
     <feature name='xsaves' migratable='no'>
       <cpuid eax_in='0x0d' ecx_in='0x01' eax='0x00000008'/>
     </feature>
+    <feature name='spec-ctrl'>
+      <cpuid eax_in='0x07' ecx_in='0x00' edx='0x04000000'/>
+    </feature>
 
     <!-- cpuid level 0x0000000f:1 (edx) -->
     <feature name='mbm_total'>
@@ -411,6 +414,11 @@
       <cpuid eax_in='0x80000007' edx='0x00000100'/>
     </feature>
 
+    <!-- More AMD-specific features -->
+    <feature name='ibpb'>
+      <cpuid eax_in='0x80000008' ebx='0x00001000'/>
+    </feature>
+
     <!-- models -->
     <model name='486'>
       <feature name='fpu'/>
